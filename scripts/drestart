#!/bin/bash

# Aide
for arg in "$@"; do
    if [[ "$arg" == "-h" || "$arg" == "--help" ]]; then
        echo "Stop Docker container. Usage: $0 [container_name_or_dir]"
        exit 0
    fi
done

# Nom du conteneur (par défaut : nom du dossier courant)
container_name="${1:-$(basename "$(pwd)")}"

# Stop + remove
docker stop "$container_name" 2>/dev/null || true
docker rm "$container_name" 2>/dev/null || true

# Si un paramètre est fourni et qu'un dossier de ce nom existe :
if [[ -n "$1" && -d "$1" ]]; then
    echo "➡️  Dossier détecté : $1 → rebuild + up"
    (
        cd "$1" || exit 1
        docker compose up -d --build --force-recreate
    )
else
    echo "➡️  Lancement dans le dossier courant → rebuild + up"
    docker compose up -d --build --force-recreate
fi
