#!/bin/bash

# Si plus de 2 param√®tres ‚Üí URL probablement non entour√©e de guillemets
if [ "$#" -gt 2 ]; then
  echo "‚ùå Trop de param√®tres d√©tect√©s"
  echo
  echo "‚ö†Ô∏è  L'URL DOIT √™tre entre guillemets"
  echo "    (sinon les & sont interpr√©t√©s par le shell)"
  echo
  echo "Usage : $0 \"<URL>\" <nom_fichier_sans_extension>"
  echo "Exemple :"
  echo "  $0 \"https://www.youtube.com/watch?v=XXX&list=YYY&index=5\" ma_video"
  exit 1
fi

# Nombre incorrect de param√®tres
if [ "$#" -ne 2 ]; then
  echo "‚ùå Mauvaise utilisation"
  echo
  echo "Usage : $0 \"<URL>\" <nom_fichier_sans_extension>"
  exit 1
fi

URL="$1"
BASENAME="$2"

# Refuser extension dans le nom de fichier
if [[ "$BASENAME" == *.* ]]; then
  echo "‚ùå Ne pas donner d'extension pour le fichier destination"
  echo "   Exemple correct   : ma_video"
  echo "   Exemple incorrect : ma_video.mp4"
  exit 1
fi

echo "üì• T√©l√©chargement avec sous-titres fran√ßais..."

# Commande exacte avec fran√ßais
yt-dlp --write-subs --sub-langs fr --embed-subs --no-playlist -o "${BASENAME}.%(ext)s" "$URL"

echo
echo "üîç V√©rification de la pr√©sence des sous-titres fran√ßais..."

# V√©rifier si un fichier .fr.srt existe
if ls "${BASENAME}"*.fr.* 2>/dev/null | grep -q .; then
  echo "‚úÖ Sous-titres fran√ßais trouv√©s et int√©gr√©s !"
else
  echo "‚ö†Ô∏è  Aucun sous-titre fran√ßais trouv√©"
  echo "üóëÔ∏è  Suppression du fichier t√©l√©charg√©..."
  rm -f "${BASENAME}".*
  
  echo "üì• Nouveau t√©l√©chargement avec sous-titres anglais..."
  
  # M√™me commande exacte mais avec anglais
  yt-dlp --write-subs --sub-langs en --embed-subs --no-playlist -o "${BASENAME}.%(ext)s" "$URL"
  
  echo
  echo "üîç V√©rification de la pr√©sence des sous-titres anglais..."
  
  if ls "${BASENAME}"*.en.srt 2>/dev/null | grep -q .; then
    echo "‚úÖ Sous-titres anglais trouv√©s et int√©gr√©s !"
  else
    echo "‚ö†Ô∏è  Aucun sous-titre disponible"
    echo "‚úÖ Vid√©o t√©l√©charg√©e sans sous-titres"
  fi
fi

echo "‚úÖ Termin√© !"
