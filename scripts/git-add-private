#!/bin/bash
# Script: git-add-private
# Usage: ./git-add-private

set -e



if [ -n "$1" ]; then
    # Si c'est une URL, on extrait le nom du repo
    if [[ "$1" =~ ^https?:// ]]; then
        REPO_NAME=$(basename "$1" .git)
    else
        REPO_NAME="$1"
    fi
else
    read -p "Nom du repository (ex: rss ou URL): " REPO_INPUT
    if [[ "$REPO_INPUT" =~ ^https?:// ]]; then
        REPO_NAME=$(basename "$REPO_INPUT" .git)
    else
        REPO_NAME="$REPO_INPUT"
    fi
fi
KEY_NAME="id_ed25519_${REPO_NAME}"
KEY_PATH="$HOME/.ssh/$KEY_NAME"

# Génère la clé SSH si elle n'existe pas déjà
if [ -f "$KEY_PATH" ]; then
    echo "[INFO] La clé $KEY_PATH existe déjà."
else
    ssh-keygen -t ed25519 -f "$KEY_PATH" -C "$USER@$REPO_NAME" -N ""
    echo "[INFO] Clé SSH générée : $KEY_PATH"
fi

# Affiche la clé publique
echo "\nAjoute cette clé publique à GitHub (Deploy Key ou SSH Key) :"
cat "$KEY_PATH.pub"
echo "\nAppuie sur Entrée quand c'est fait..."
read

# Configure temporairement l'utilisation de la clé pour ce repo
GIT_SSH_COMMAND="ssh -i $KEY_PATH" git pull
